#!/bin/bash
logInfo "$BASH_SOURCE" "$LINENO" 'Configuring Python virtualenv...'

# Verify PIP integration
requireVariable "$BASH_SOURCE" "$LINENO" PIP_DOWNLOAD_CACHE
requireVariable "$BASH_SOURCE" "$LINENO" PIP_REQUIRE_VIRTUALENV
requireVariable "$BASH_SOURCE" "$LINENO" PIP_RESPECT_VIRTUALENV

requireVariable "$BASH_SOURCE" "$LINENO" BO_Project
_Script=$BO_Project/PVE/bin/activate

# If the virtual environment does not already exist, create it
[[ ! -f "${_Script}" ]] && \
  logWarn 'Creating Python virtual environment (PVE)' && \
  virtualenv --no-site-packages $BO_Project/PVE

# Activate the Python virtual environment (PVE)
requireDirectory $BO_Project/PVE
requireFile ${_Script}
source ${_Script}
requireVariable "$BASH_SOURCE" "$LINENO" VIRTUAL_ENV
export PYTHONHOME=$VIRTUAL_ENV
requireVariable "$BASH_SOURCE" "$LINENO" PYTHONHOME

# Return, but do NOT exit, with a success code
return 0

